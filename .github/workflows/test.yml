name: 'go test'
on:   ['push', 'pull_request']
jobs:
  test:
    strategy:
      matrix:
        go-version: ['1.21.x', '1.24.x']
        os:         ['ubuntu-latest', 'macos-latest', 'windows-latest']
    runs-on: ${{ matrix.os }}
    steps:
      - uses: 'actions/setup-go@v4'
        with:
          go-version: ${{ matrix.go-version }}
      - uses: 'actions/checkout@v4'
      - uses: 'toml-lang/setup-toml-test@main'
        with:
          decoder:    'toml-test-decoder'
          encoder:    'toml-test-encoder'
          mainBranch: 'master'
          version:    'main'
      - run: |
          go build ./cmd/toml-test-decoder
          go build ./cmd/toml-test-encoder
          go test -race ./...
